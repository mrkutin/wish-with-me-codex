; CouchDB Local Configuration for Wish With Me
; This file is mounted into the CouchDB container

[couchdb]
single_node = true
max_document_size = 8388608

[chttpd]
port = 5984
bind_address = 0.0.0.0
; Require authentication for all requests (JWT or cookie)
; Admin endpoints still require admin credentials
require_valid_user = true

; Authentication handlers - JWT first, then cookie, then default
[chttpd_auth]
authentication_handlers = {chttpd_auth, jwt_authentication_handler}, {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, default_authentication_handler}
timeout = 86400
allow_persistent_cookies = true

; JWT Configuration
; The secret key will be set via environment variable or API call during init
[jwt_auth]
required_claims = exp,sub
algorithms = HS256

; CORS Configuration for PouchDB sync
[cors]
origins = https://wishwith.me, https://api.wishwith.me, http://localhost:9000, http://localhost:9100
credentials = true
methods = GET, PUT, POST, HEAD, DELETE, OPTIONS
headers = accept, authorization, content-type, origin, referer, x-csrf-token

; Replicator settings
[replicator]
max_jobs = 50
interval = 60000

; Compaction settings
[compactions]
_default = [{db_fragmentation, "70%"}, {view_fragmentation, "60%"}]

; Logging
[log]
level = info
writer = stderr

; Feature flags
[feature_flags]
partitioned||* = true

; Query server
[query_servers]
javascript = /opt/couchdb/bin/couchjs /opt/couchdb/share/server/main.js
